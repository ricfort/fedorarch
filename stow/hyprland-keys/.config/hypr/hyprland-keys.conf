#!/usr/bin/env bash
set -euo pipefail

CONFIG_FILE="${HYPRLAND_CONFIG:-$HOME/.config/hypr/hyprland.conf}"

if [ ! -f "$CONFIG_FILE" ]; then
    echo "Error: Hyprland config not found at $CONFIG_FILE"
    exit 1
fi

if ! command -v tofi >/dev/null 2>&1; then
    echo "Error: tofi is not installed or not in PATH"
    exit 1
fi

binds=$(grep -E "^bind.*=" "$CONFIG_FILE" | \
        sed 's/bind.*=[ ]*\(.*\),[ ]*\(.*\)/\1 → \2/' | sort)

if [ -z "$binds" ]; then
    echo "No keybinds found in config"
    exit 1
fi

echo "$binds" | tofi --prompt-text="󰌌 " \
    --width=50% --height=50% \
    --anchor=center \
    --font="CaskaydiaCove Nerd Font" \
    --font-size=14 \
    --background-color="#1a1612e6" \
    --text-color="#d4c4b0" \
    --prompt-color="#d4a574" \
    --selection-color="#1a1612" \
    --selection-background="#d4a574" \
    --border-color="#d4a574" \
    --outline-color="#5c4a3a" \
    --border-width=2 \
    --outline-width=2 \
    --padding-top=60 --padding-left=60 --padding-right=60 --padding-bottom=60 \
    --result-spacing=16 \
    --num-results=15
