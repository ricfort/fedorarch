#!/bin/bash
# System performance monitoring script

echo "=== System Performance Monitor ==="
echo "Date: $(date '+%Y-%m-%d %H:%M:%S')"
echo ""

# CPU Usage
echo "=== Top CPU Consumers ==="
ps aux --sort=-%cpu | head -6 | awk 'NR==1{print $0} NR>1{printf "%-10s %5s%% %5s%% %s\n", $1, $3, $4, $11}'
echo ""

# Memory Usage
echo "=== Memory Usage ==="
free -h | awk 'NR==1{print "Type       Total   Used    Free    Shared  Buff/Cache  Available"} NR==2||NR==3{print $0}'
echo ""

# Hyprland Performance
echo "=== Hyprland Status ==="
hyprctl version | head -1
echo "Active monitors: $(hyprctl monitors -j | jq -r 'length')"
echo "Active windows: $(hyprctl clients -j | jq -r 'length')"
echo ""

# Wayland Services
echo "=== Wayland Services ==="
systemctl --user is-active pipewire wireplumber cliphist 2>/dev/null | paste -d' ' - - - | awk '{print "pipewire: " $1 "  wireplumber: " $2 "  cliphist: " $3}'
echo ""

# Disk Usage (workspace)
echo "=== Disk Usage ==="
df -h ~ | awk 'NR==1{print $0} NR==2{print $0}'
echo ""

# Temperature
echo "=== Temperature ==="
if command -v sensors >/dev/null 2>&1; then
    sensors | grep -E "^(Package|Core|CPU)" | head -5
else
    echo "lm_sensors not installed (install with: sudo dnf install lm_sensors)"
fi
echo ""

# GPU (if available)
echo "=== GPU Status ==="
if command -v nvidia-smi >/dev/null 2>&1; then
    nvidia-smi --query-gpu=name,temperature.gpu,utilization.gpu,memory.used,memory.total --format=csv,noheader
elif [ -d /sys/class/drm/card0/device ]; then
    echo "Integrated GPU detected"
    if [ -f /sys/class/drm/card0/device/gpu_busy_percent ]; then
        echo "GPU Usage: $(cat /sys/class/drm/card0/device/gpu_busy_percent)%"
    fi
else
    echo "No GPU monitoring available"
fi
echo ""

echo "=== Performance Tips ==="
echo "- Waybar CPU: $(ps aux | grep [w]aybar | awk '{print $3}')%"
echo "- Hyprland CPU: $(ps aux | grep [H]yprland | awk '{print $3}')%"
echo ""




